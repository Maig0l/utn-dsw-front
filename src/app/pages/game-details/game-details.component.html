<main>
  <section class="selected-game">
    @if (game) {
      <ng-container *ngTemplateOutlet="loadedGame"> </ng-container>
    } @else {
      <ng-container *ngTemplateOutlet="loading"></ng-container>
    }
  </section>

  <section class="reviews">
    <!-- TODO: @If(usuarioEstáLogueado) mostrar el formulario -->

    <!--    <app-review-form [game]="this.game">-->
    <!--    </app-review-form>-->
  </section>
</main>

<ng-template #loading>
  <h1>Loading</h1>
</ng-template>

<ng-template #loadedGame>
  <div class="game-banner">
    <img [src]="apiUrl + game.banner" alt="Game's banner" />
  </div>

  <dialog id="deleteModal">
    <h1>Delete game: {{ game.title }}</h1>
    <p>Are you sure?</p>
    <div class="modalButtons">
      <button mat-fab extended (click)="closeModal()" id="closeModal">
        <mat-icon>close</mat-icon>Cancel
      </button>
      <button
        mat-fab
        extended
        (click)="deleteGame(); closeModal()"
        id="closeModal"
        class="deleteButton"
      >
        <mat-icon>delete</mat-icon>
        Delete
      </button>
    </div>
  </dialog>

  <button mat-button [matMenuTriggerFor]="menu" id="menuButton">
    <mat-icon>menu</mat-icon>
  </button>
  <mat-menu #menu="matMenu" xPosition="before">
    <a id="menu-item-link" href="edit-game/{{ game.id }}">
      <button mat-menu-item>
        <mat-icon>edit</mat-icon>
        Edit
      </button>
    </a>

    <button mat-menu-item (click)="openModal()" id="openModal">
      <mat-icon>delete</mat-icon>
      Delete
    </button>
  </mat-menu>

  <div class="game-info">
    <div class="first-column">
      <img [src]="apiUrl + game.portrait" alt="Game's portrait" class="game-portrait" />

      <!-- TODO: If user.isAdmin . <button> inside <a>?? -->
      <div class="game-actions"></div>
    </div>
    <div class="game-details">
      <h1 class="game-title">{{ game.title }}</h1>
      <p class="game-synopsis">{{ game.synopsis }}</p>
      <div class="studio-container">
        <p class="studio">
          Developer/s:
          @for (studio of devs; track studio.id) {
            <a [href]="studio.site" target="_blank" rel="noopener noreferrer">{{ studio.name }}</a>
          }
        </p>
        <p class="studio">
          Publisher/s:
          @for (studio of pubs; track studio.id) {
            <a [href]="studio.site">{{ studio.name }}</a>
          }
        </p>
      </div>
      <div class="platforms">
        <span>Available on:</span>
        @for (platform of game.platforms; track platform.id) {
          <img [src]="platform.img" [alt]="platform.name" />
        }
      </div>
    </div>
  </div>

  <!-- TODO: Crear componente picture-carousel y extraer allí -->
  @if (game.pictures.length > 0) {
    <section class="game-images">
      <div class="slider">
        <div>
          <span (click)="goToPrevious()" class="leftArrow">❰</span>
          <span (click)="goToNext()" class="rightArrow">❱</span>
        </div>
        <img class="slide" alt="carrusel image" [src]="getCurrentSlideUrl()" />
        <div class="dotsContainer">
          @for (slide of game.pictures; track $index) {
            <!-- TODO: Poner el punto de la imagen actual en blanco y el resto más oscuro -->
            <span class="dot" (click)="goToSlide($index)">●</span>
          }
        </div>
      </div>
    </section>
  }
</ng-template>

<ng-template #reviewsSection> </ng-template>
